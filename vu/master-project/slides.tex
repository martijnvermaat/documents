\documentclass[notheorems]{beamer}

\usepackage[english]{babel}

\usepackage[latin1]{inputenc}

\input{abbrevs}

\usepackage[T1]{fontenc}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}

\theoremstyle{definition}
\newtheorem{definition}{Definition}

%\usepackage{tgtermes}
\usepackage{tgheros}
%\usepackage{cmbright}
\usepackage{qtxmath}
%\usepackage{kpfonts}
\renewcommand{\ttdefault}{txtt}

%\usepackage[amsmath,thmmarks]{ntheorem}

\usepackage{tikz}
\usetikzlibrary{arrows,positioning,chains}

\usepackage[color]{coqdoc}
\setlength{\coqdocbaseindent}{0.7em}

\usepackage{beamerthemesplit}

\setbeamertemplate{background canvas}[vertical shading][bottom=red!10,top=blue!10]
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{headline}{}
\usetheme{Warsaw}
\useinnertheme{rectangles}

\colorlet{darkred}{red!80!black}
\colorlet{darkblue}{blue!80!black}
\colorlet{darkgreen}{green!80!black}

\title{Infinitary Rewriting in \Coq}

\author{Martijn Vermaat}
\institute{VU University Amsterdam}
\date{August 2010}


\begin{document}


\frame{\titlepage}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents

}


\section{Introduction}


\frame{

  \frametitle{Why?}

  Why formalize a mathematical theory mechanically?

  \begin{itemize}
    \item Increases confidence in theorems
    \item Might catch oversights or errors in proofs
    \item Automation
    \item Can form the basis of useful tools
  \end{itemize}

}


\frame{

  \frametitle{\Coq}

  \Coq is a \emph{proof assistant}

%  \pause
  \begin{itemize}%[<+->]
    \item (interactive) theorem prover
    \item proof checker
    \item programming language
    \item certified program extractor
  \end{itemize}

\begin{coqdoccode}
\coqdocemptyline
\coqdocemptyline
\coqdockw{Inductive} \coqdocinductive{nat}
:
\coqdockw{Set} :=\coqdoceol
\coqdocindent{0.3em}
\ensuremath{|} \coqdocconstructor{O}
:
\coqdocinductive{nat}\coqdoceol
\coqdocindent{0.3em}
\ensuremath{|} \coqdocconstructor{S}
:
\coqdocinductive{nat} \ensuremath{\rightarrow}
\coqdocinductive{nat}.
\coqdocindent{7.50em}
\coqdockw{Lemma}
\coqdoclemma{$+_0$}
: \ensuremath{\forall} \coqdocvar{n},
\coqdocvariable{n} = \coqdocvariable{n} + 0.\coqdoceol
\end{coqdoccode}

\begin{coqdoccode}
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint}
+ (\coqdocvar{n} \coqdocvar{m} :
\coqdocinductive{nat}) :
\coqdocinductive{nat} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{n} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow} \coqdocvariable{m}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{n} \ensuremath{\Rightarrow}
\coqdocconstructor{S} (\coqdocvar{n} + \coqdocvar{m})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Related work}

  \begin{block}{Rewriting in \Coq}
    \begin{description}
    \item[\CoLoR] focussed on termination
    \item[\Coccinelle] base of \CiME termination tool
    \end{description}
  \end{block}

  \begin{block}{Ordinals in \Coq}
    \begin{itemize}
    \item Cantor and Veblen normal forms (Cast\'eran)
    \item Set-theoretic surreal numbers (Mamane)
    \end{itemize}
  \end{block}

}


\section{Infinite terms}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents[currentsection]

}


\frame{

  \frametitle{Coinductive terms}

  $\TerI(\X)$ defined in \Coq:\\[2em]

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{CoInductive}
\coqdocinductive{term} :
\coqdockw{Type} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Var} :
\coqdocvar{X}
\ensuremath{\rightarrow}
\coqdocinductive{term}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Fun} :
\ensuremath{\forall} \coqdocvar{f} : \coqdocvar{F},
\coqdocdefinition{vector}
\coqdocinductive{term}
(\coqdocprojection{arity} \coqdocvariable{f})
\ensuremath{\rightarrow}
\coqdocinductive{term}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

We use a recursive vector type instead of the standard inductive one

}


\frame{

  \frametitle{Equalities on infinite terms}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{CoInductive}
$\sim$ :
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{$\sim_\text{Var}$}
:
\ensuremath{\forall} \coqdocvar{x},
\coqdocconstructor{Var} \coqdocvariable{x}
$\sim$
\coqdocconstructor{Var}
\coqdocvariable{x}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{$\sim_\text{Fun}$}
:
\ensuremath{\forall} \coqdocvar{f} \coqdocvar{v} \coqdocvar{w},
(\ensuremath{\forall} \coqdocvar{i},
\coqdocvariable{v} \coqdocvariable{i}
$\sim$
\coqdocvariable{w} \coqdocvariable{i})
\ensuremath{\rightarrow}
\coqdocconstructor{Fun} \coqdocvariable{f}
\coqdocvariable{v}
$\sim$
\coqdocconstructor{Fun} \coqdocvariable{f}
\coqdocvariable{w}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Inductive}
\equpto{}
:
\coqdocinductive{nat}
\ensuremath{\rightarrow} \coqdocinductive{term}
\ensuremath{\rightarrow} \coqdocinductive{term}
\ensuremath{\rightarrow} \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{teut$_0$}   :
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t},
\coqdocvariable{s} \equpto{0}
\coqdocvariable{t}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{teut$_\text{Var}$}
:
\ensuremath{\forall} \coqdocvar{d} \coqdocvar{x},
\coqdocconstructor{Var} \coqdocvariable{x}
\equpto{\coqdocvariable{d}}
\coqdocconstructor{Var}
\coqdocvariable{x}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{teut$_\text{Fun}$}
:
\ensuremath{\forall} \coqdocvar{d} \coqdocvar{f} \coqdocvar{v}
\coqdocvar{w},\coqdoceol
\coqdocindent{4em}
(\ensuremath{\forall} \coqdocvar{i},
\coqdocvariable{v} \coqdocvariable{i}
\equpto{\coqdocvariable{d}}
\coqdocvariable{w} \coqdocvariable{i}) \ensuremath{\rightarrow}
\coqdocconstructor{Fun}
\coqdocvariable{f} \coqdocvariable{v}
\equpto{\coqdocconstructor{S} \, \coqdocvariable{d}}
\coqdocconstructor{Fun} \coqdocvariable{f}
\coqdocvariable{w}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocvar{s}
$\equiv$
\coqdocvar{t} :=
\ensuremath{\forall} \coqdocvar{d},
\coqdocvariable{s}
\equpto{\coqdocvariable{d}}
\coqdocvariable{t}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{eq$_\equiv^\sim$}
: \ensuremath{\forall} \coqdocvar{s} \coqdocvar{t},
\coqdocvariable{s}
$\sim$
\coqdocvariable{t} \ensuremath{\leftrightarrow}
\coqdocvariable{s}
$\equiv$
\coqdocvariable{t}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Term rewriting systems}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Record} \coqdocrecord{rule} :
\coqdockw{Type} :=
\coqdocconstructor{Rule} \{\coqdoceol
\coqdocindent{1.00em}
\coqdocprojection{lhs}     :
\coqdocinductive{finite\_term};\coqdoceol
\coqdocindent{1.00em}
\coqdocprojection{rhs}     :
\coqdocinductive{finite\_term};\coqdoceol
\coqdocindent{1.00em}
\coqdocprojection{rule\_wf} :
\coqdocdefinition{is\_var}
\coqdocmethod{lhs} =
\coqdocconstructor{false}
\ensuremath{\land}
\coqdocdefinition{incl}
(\coqdocdefinition{vars}
\coqdocmethod{rhs})
(\coqdocdefinition{vars}
\coqdocmethod{lhs})\coqdoceol
\coqdocnoindent
\}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{left\_linear}
(\coqdocvar{r} : \coqdocrecord{rule}) :
\coqdockw{Prop} :=
\coqdocdefinition{linear}
(\coqdocprojection{lhs}
\coqdocvariable{r}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{trs} :=
\coqdocinductive{list}
\coqdocrecord{rule}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{trs\_left\_linear} (\coqdocvar{$\mathcal{R}$} : \coqdocdefinition{trs}) :
\coqdockw{Prop} :=\coqdoceol
\coqdocindent{1em}
\coqdocinductive{Forall} \coqdocdefinition{left\_linear}
\coqdocvar{$\mathcal{R}$}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Orthogonality}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{critical\_pair}
(\coqdocvar{$\mathcal{R}$} : \coqdocdefinition{trs})
(\coqdocvar{t$_1$} \coqdocvar{t$_2$} :
\coqdocinductive{term}) : \coqdockw{Prop}
:=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{\exists} \coqdocvar{$\rho_1$} :
\coqdocrecord{rule}, \ensuremath{\exists}
\coqdocvar{$\rho_2$} :
\coqdocrecord{rule},
\ensuremath{\exists} \coqdocvar{p} :
\coqdocabbreviation{position},
\ensuremath{\exists} \coqdocvar{$\sigma$},
\ensuremath{\exists} \coqdocvar{$\tau$},\coqdoceol
\coqdocindent{3.00em}
\coqdocvariable{$\rho_1$} \coqdocdefinition{$\in$}
\coqdocvariable{$\mathcal{R}$}
\ensuremath{\land}
\coqdocvariable{$\rho_2$} \coqdocdefinition{$\in$}
\coqdocvar{$\mathcal{R}$} \ensuremath{\land}
(\coqdocvariable{$\rho_1$} = \coqdocvariable{$\rho_2$} \ensuremath{\rightarrow}
\coqdocvariable{p} \ensuremath{\not=}
\coqdocconstructor{nil})
\ensuremath{\land}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{match}
(\coqdocprojection{lhs}
\coqdocvariable{$\rho_1$})|$_{\coqdocvariable{p}}$,
\coqdocvariable{C}[(\coqdocprojection{lhs}
\coqdocvariable{$\rho_1$})$^{\coqdocvariable{$\sigma$}}$]$_{\coqdocvariable{p}}$ \coqdockw{with}\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|}
\coqdocconstructor{Some}
\coqdocvar{s},
\coqdocconstructor{Some}
\coqdocvar{c} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{5.00em}
\coqdocdefinition{is\_var} \coqdocvariable{s} =
\coqdocconstructor{false}
\ensuremath{\land}
\coqdocvariable{s}$^{\coqdocvariable{$\sigma$}}$ $\sim$
(\coqdocprojection{lhs}
\coqdocvariable{$\rho_2$})$^{\coqdocvariable{$\tau$}}$
\ensuremath{\land}\coqdoceol
\coqdocindent{5.00em}
\coqdocvariable{t$_1$} $\sim$
\coqdocvariable{c}[(\coqdocprojection{rhs}
\coqdocvariable{$\rho_2$})$^{\coqdocvariable{$\tau$}}$] \ensuremath{\land}
\coqdocvariable{t$_2$} $\sim$
(\coqdocprojection{rhs}
\coqdocvariable{$\rho_1$})$^{\coqdocvariable{$\sigma$}}$\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|} \coqdocvar{\_}, \coqdocvar{\_}
\ensuremath{\Rightarrow}
\coqdocinductive{False}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{orthogonal} (\coqdocvar{$\mathcal{R}$} :
\coqdocdefinition{trs})
: \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{trs\_left\_linear}
\coqdocvariable{$\mathcal{R}$} \ensuremath{\land}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{\forall} \coqdocvar{t$_1$} \coqdocvar{t$_2$}, \ensuremath{\lnot}
\coqdocdefinition{critical\_pair}
\coqdocvariable{t$_1$} \coqdocvariable{t$_2$}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{weakly\_orthogonal} (\coqdocvar{$\mathcal{R}$} :
\coqdocdefinition{trs})
: \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{trs\_left\_linear}
\coqdocvariable{$\mathcal{R}$} \ensuremath{\land}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{\forall} \coqdocvar{t$_1$} \coqdocvar{t$_2$},
\coqdocdefinition{critical\_pair}
\coqdocvariable{t$_1$} \coqdocvariable{t$_2$} \ensuremath{\rightarrow}
\coqdocvariable{t$_1$} $\sim$ \coqdocvariable{t$_2$}.\coqdoceol
\end{coqdoccode}

}


\section{Ordinal numbers}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents[currentsection]

}


\frame{

  \frametitle{Brouwer ordinals}

\begin{definition}
The set of \emph{Brouwer ordinals} $\Ord$ is defined by induction:
\begin{itemize}
  \item
    $0 \in \Ord$
  \item
    If $\alpha \in \Ord$, then $\alpha^+ \in \Ord$
  \item
    If $\alpha_i \in \Ord$ for all $i \in \mathbb{N}$, then $\sqcup_i
    \alpha_i \in \Ord$
\end{itemize}
\end{definition}

\begin{itemize}
  \item We need an order on $\Ord$
  \item It should position $\sqcup_i i + 3$ and $\sqcup_i i \times 2$
    at the same rank
  \item And what to make of $\sqcup \{ 3, 3, 3, \ldots \}$?
\end{itemize}

}


\frame{

  \frametitle{Structural partial order on $\Ord$}

\begin{definition}
The set-valued function $\Phi$ defines the \emph{predecessor indices}
$\Phi(\alpha)$
\emph{for} $\alpha$ by recursion on $\alpha$:
\begin{align*}
  \Phi(0)                 &= \emptyset \\
  \Phi(\alpha^+)          &= \Phi(\alpha)^? \\
  \Phi(\sqcup_i \alpha_i) &= (\Sigma n \in \mathbb{N}) \;
  \Phi(\alpha_n)
\end{align*}
\end{definition}

\begin{definition}
The function $\_[\_] : (\prod \alpha : \Ord) \; \Phi(\alpha)
\rightarrow
\Ord$ defines the \emph{predecessor} $\alpha[\iota]$ \emph{of}
$\alpha$ \emph{indexed by} $\iota$ recursively on $\alpha$:
\begin{align*}
  \alpha^+[\textsc{none}]                     &= \alpha \\
  \alpha^+[\textsc{some $\iota$}]             &= \alpha[\iota] \\
  \sqcup_i \alpha_i[\langle n, \iota \rangle] &= \alpha_n[\iota]
\end{align*}
\end{definition}

}


\frame{

  \frametitle{Extensional order on $\Ord$}

\begin{definition}
We define the \emph{order} $\preceq$ as a binary relation on $\Ord$ by
induction:
\begin{itemize}
  \item
    $0 \preceq \beta$ for every ordinal $\beta \in \Ord$
  \item
    For all $\alpha, \beta \in \Ord$ and $\iota \in \Phi(\beta)$, if
    $\alpha \preceq \beta[\iota]$ then $\alpha^+ \preceq \beta$
  \item
    For all $\alpha_0, \alpha_1, \alpha_2, \ldots, \beta \in \Ord$, if
    $\alpha_n \preceq \beta$ for all $n \in \mathbb{N}$, then
    $\sqcup_i
    \alpha_i \preceq \beta$
\end{itemize}
\end{definition}

\begin{itemize}
  \item $\alpha \simeq \beta$ if $\alpha \preceq \beta$ and $\beta
    \preceq \alpha$
  \item $\alpha \prec \beta$ if $\alpha \preceq \beta[\iota]$ for some
    $\iota \in \Phi(\beta)$
\end{itemize}

}


\frame{

  \frametitle{Brouwer ordinals in \Coq}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Inductive} \coqdocinductive{ord}
:
\coqdockw{Set} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Zero}
:
\coqdocinductive{ord}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Succ}
:
\coqdocinductive{ord} \ensuremath{\rightarrow}
\coqdocinductive{ord}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{Limit} :
(\coqdocinductive{nat}
\ensuremath{\rightarrow} \coqdocinductive{ord})
\ensuremath{\rightarrow}
\coqdocinductive{ord}.\coqdoceol
\end{coqdoccode}

\begin{coqdoccode}
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocdefinition{wf}
\coqdocvar{\ensuremath{\alpha}} : \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{\ensuremath{\alpha}}
\coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Zero}
\ensuremath{\Rightarrow}
\coqdocinductive{True}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Succ}
\coqdocvar{\ensuremath{\beta}} \ensuremath{\Rightarrow}
\coqdocdefinition{wf}
\coqdocvariable{\ensuremath{\beta}}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Limit}
\coqdocvar{f}
\ensuremath{\Rightarrow} \ensuremath{\forall} \coqdocvar{n},
\coqdocdefinition{wf} (\coqdocvariable{f}
\coqdocvariable{n}) \ensuremath{\land} \ensuremath{\forall}
\coqdocvar{m},
\coqdocvariable{n} < \coqdocvariable{m} \ensuremath{\rightarrow}
\coqdocvariable{f} \coqdocvariable{n} \ensuremath{\prec}
\coqdocvariable{f} \coqdocvariable{m}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{ord$^\text{wf}$}
: \coqdockw{Set}
:=
\coqdocinductive{sig} \coqdocdefinition{wf}.\coqdoceol
\end{coqdoccode}

}


\section{Rewrite sequences of ordinal length}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents[currentsection]

}


\frame{

  \frametitle{Rewrite steps}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Inductive}
$\rightarrow_\mathcal{R}$ :
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdockw{Type} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Step}
:
\ensuremath{\forall} (\coqdocvar{s} \coqdocvar{t} :
\coqdocinductive{term}) (\coqdocvar{$\rho$} :
\coqdocrecord{rule}) (\coqdocvar{c} :
\coqdocinductive{context}) (\coqdocvar{$\sigma$} :
\coqdocdefinition{substitution}),\coqdoceol
\coqdocindent{6.50em} \coqdocvariable{$\rho$}
\coqdocdefinition{$\in$}
\coqdocvar{$\mathcal{R}$} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{6.50em}
\coqdocvariable{c}[(\coqdocprojection{lhs}
\coqdocvariable{$\rho$})\coqdocvariable{$^\sigma$}] $\sim$
\coqdocvariable{s}
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{6.50em}
\coqdocvariable{c}[(\coqdocprojection{rhs}
\coqdocvariable{$\rho$})\coqdocvariable{$^\sigma$}] $\sim$
\coqdocvariable{t}
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{6.50em}
\coqdocvariable{s} $\rightarrow_\mathcal{R}$
\coqdocvariable{t}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Rewrite sequences}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Inductive}
$\twoheadrightarrow_\mathcal{R}$
:
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdocinductive{term} \ensuremath{\rightarrow}
\coqdockw{Type} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Nil} :
\ensuremath{\forall} \coqdocvar{t}, \coqdocvariable{t}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t}\coqdoceol \coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Cons}
:
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u},
\coqdocvar{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvar{t}
$\rightarrow$
\coqdocvariable{t} $\rightarrow_\mathcal{R}$
\coqdocvar{u} $\rightarrow$ \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{u}\coqdoceol \coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Lim}   :
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t},
(\coqdocinductive{nat}
\ensuremath{\rightarrow} \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\textbf{?})
$\rightarrow$
\coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

Parameterize \coqdocconstructor{Lim} with target terms of
branches, they should converge to \coqdocvariable{t}.

\begin{coqdoccode}
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Lim} :
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t}
(\coqdocvar{ts} :
\coqdocinductive{nat}
\ensuremath{\rightarrow} \coqdocinductive{term}),
\coqdocdefinition{converges}
\coqdocvariable{ts}
\coqdocvariable{t} $\rightarrow$\coqdoceol
\coqdocindent{5em}
(\ensuremath{\forall} \coqdocvar{n}, \coqdocvar{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvar{ts} \coqdocvariable{n}) $\rightarrow$
\coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t}\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Predecessor indices for $\twoheadrightarrow_\mathcal{R}$}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint}
\coqdocdefinition{pred\_type}
\coqdocvar{s} \coqdocvar{t}
(\coqdocvar{$\varphi$} : \coqdocvar{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvar{t}) :
\coqdockw{Type} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{$\varphi$} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Nil}
\coqdocvar{\_}
\ensuremath{\Rightarrow}
\coqdocinductive{False}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Cons}
\coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{$\psi$}
\coqdocvar{\_}
\ensuremath{\Rightarrow}
\coqdocinductive{unit}
+ \coqdocdefinition{pred\_type}
\coqdocvariable{$\psi$}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Lim}
\coqdocvar{\_}
\coqdocvar{\_} \coqdocvar{\_} \coqdocvar{f} \coqdocvar{\_}
\ensuremath{\Rightarrow} \{ \coqdocvar{n} :
\coqdocinductive{nat}
\& \coqdocdefinition{pred\_type}
(\coqdocvariable{f} \coqdocvariable{n}) \}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\end{coqdoccode}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint}
\coqdocdefinition{pred}
\coqdocvar{s} \coqdocvar{t} (\coqdocvar{$\varphi$} : \coqdocvar{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvar{t})
(\coqdocvar{$\iota$} :
\coqdocdefinition{pred\_type}
\coqdocvariable{$\varphi$})
:\coqdoceol \coqdocindent{2.00em}
\{ \coqdocvar{ts} :
\coqdocabbreviation{term} \ensuremath{\times}
\coqdocabbreviation{term} \&
(\coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{fst}
\coqdocvariable{ts}) \ensuremath{\times}
(\coqdocdefinition{fst}
\coqdocvariable{ts} $\rightarrow_\mathcal{R}$
\coqdocdefinition{snd}
\coqdocvariable{ts}) \} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{$\varphi$} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Nil}
\coqdocvar{\_}
\ensuremath{\Rightarrow}
(\coqdocdefinition{False\_rect}
\coqdocvar{\_}) \coqdocvariable{$\iota$} \coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Cons}
\coqdocvar{\_}
\coqdocvar{u} \coqdocvar{t} \coqdocvar{$\psi$} \coqdocvar{$\pi$}
\ensuremath{\Rightarrow}
\coqdockw{match} \coqdocvariable{$\iota$} \coqdockw{with}\coqdoceol
\coqdocindent{10.00em}
\ensuremath{|}
\coqdocconstructor{inl}
\coqdocconstructor{tt}
\ensuremath{\Rightarrow}
\coqdocconstructor{existT}
\coqdocvar{\_} (\coqdocvariable{u}, \coqdocvariable{t})
(\coqdocvariable{$\psi$}, \coqdocvariable{$\pi$})\coqdoceol
\coqdocindent{10.00em}
\ensuremath{|}
\coqdocconstructor{inr}
\coqdocvar{$\kappa$}  \ensuremath{\Rightarrow}
\coqdocdefinition{pred}
\coqdocvariable{$\psi$}
\coqdocvariable{$\kappa$}\coqdoceol
\coqdocindent{10.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Lim}
\coqdocvar{\_}
\coqdocvar{\_} \coqdocvar{\_} \coqdocvar{f} \coqdocvar{\_}
\ensuremath{\Rightarrow}
\coqdockw{match} \coqdocvariable{$\iota$} \coqdockw{with}\coqdoceol
\coqdocindent{10.00em}
\ensuremath{|}
\coqdocconstructor{existT}
\coqdocvar{n} \coqdocvar{$\kappa$} \ensuremath{\Rightarrow}
\coqdocdefinition{pred} (\coqdocvariable{f}
\coqdocvariable{n}) \coqdocvariable{$\kappa$}\coqdoceol
\coqdocindent{10.00em}
\coqdockw{end}
\coqdockw{end}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Notations for predecessor indexing}

{\renewcommand{\arraystretch}{1.1}
\renewcommand{\tabcolsep}{10pt}
\begin{tabular}{ll}
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}] & location of
\coqdocvariable{$\varphi$} indexed by \coqdocvariable{$\iota$}\\
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{seq}$ &
predecessor rewrite sequence of \coqdocvariable{$\varphi$} indexed by
\coqdocvariable{$\iota$}\\
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{stp}$ &
step of \coqdocvariable{$\varphi$} indexed by
\coqdocvariable{$\iota$}\\
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{l}$ &
source term of
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{stp}$
(also target term of
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{seq}$)\\
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{r}$ &
target term of
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{stp}$
\end{tabular}}\\[2em]

\begin{center}
\coqdocvariable{$\varphi$}[\coqdocvariable{$\iota$}]$^\textsc{stp}$
\ \ \ \ \ \ instead of \ \ \ \ \ \ \coqdocdefinition{snd}
(\coqdocdefinition{projT2} (\coqdocdefinition{pred}
\coqdocvariable{$\varphi$} \coqdocvariable{$\iota$}))
\end{center}

}


\frame{

  \frametitle{Example}

\begin{center}
\begin{tikzpicture}[scale=0.84]
\input{figures/predecessor.tikz}
\end{tikzpicture}
\end{center}

\footnotesize{Rewrite sequence of length $\omega + 2$ with predecessor index
$\coqdocconstructor{inr} \; (\coqdocconstructor{inr} \; \langle 4,
\coqdocconstructor{inl}\rangle)$}

}


\frame{

  \frametitle{Embeddings of rewrite sequences}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Inductive} $\sqsubseteq$
: \ensuremath{\forall} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u}
\coqdocvar{v}, \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t}
$\rightarrow$ \coqdocvariable{u}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{v}
$\rightarrow$ \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{$\sqsubseteq_\text{Nil}$}
:
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{u} \coqdocvar{v}
(\coqdocvar{$\psi$}
: \coqdocvariable{u}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{v}),\coqdoceol
\coqdocindent{9.50em}
\coqdocconstructor{Nil} \coqdocvariable{s}
$\sqsubseteq$
\coqdocvariable{$\psi$}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{$\sqsubseteq_\text{Cons}$}
:
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u}
\coqdocvar{v}
(\coqdocvar{$\psi$}
: \coqdocvariable{u}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{v}) (\coqdocvar{$\iota$} :
\coqdocdefinition{pred\_type}
\coqdocvariable{$\psi$})\coqdoceol
\coqdocindent{5.00em}
(\coqdocvar{$\varphi$} : \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{$\psi$}[\coqdocvariable{$\iota$}]$^\textsc{l}$)
(\coqdocvar{$\pi$} :
\coqdocvariable{$\psi$}[\coqdocvariable{$\iota$}]$^\textsc{l}$
$\rightarrow_\mathcal{R}$
\coqdocvariable{t}),\coqdoceol
\coqdocindent{9.50em}
\coqdocvariable{$\varphi$} $\sqsubseteq$
\coqdocvariable{$\psi$}[\coqdocvariable{$\iota$}]$^\textsc{seq}$
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{9.50em}
\coqdocvariable{$\pi$} $\approx$
\coqdocvariable{$\psi$}[\coqdocvariable{$\iota$}]$^\textsc{stp}$
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{9.50em}
\coqdocconstructor{Cons}
\coqdocvariable{$\varphi$} \coqdocvariable{$\pi$}
$\sqsubseteq$
\coqdocvariable{$\psi$}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{$\sqsubseteq_\text{Lim}$}
:
\ensuremath{\forall} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u}
\coqdocvar{v}
(\coqdocvar{ts} :
\coqdocinductive{nat}
\ensuremath{\rightarrow} \coqdocinductive{term})
(\coqdocvar{f} : \ensuremath{\forall} \coqdocvar{n},
\coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{ts} \coqdocvariable{n})\coqdoceol
\coqdocindent{5.00em}
(\coqdocvar{c} :
\coqdocdefinition{converges}
\coqdocvariable{ts}
\coqdocvar{t}) (\coqdocvar{$\psi$} : \coqdocvar{u}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvar{v}),\coqdoceol
\coqdocindent{9.50em}
(\ensuremath{\forall} \coqdocvar{n}, \coqdocvariable{f}
\coqdocvariable{n}
$\sqsubseteq$ \coqdocvariable{$\psi$})
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{9.50em}
\coqdocconstructor{Lim} \coqdocvariable{f}
\coqdocvariable{c} $\sqsubseteq$
\coqdocvariable{$\psi$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition}
$\sqsubset$
\coqdocvar{s} \coqdocvar{t} \coqdocvar{u} \coqdocvar{v}
(\coqdocvar{$\varphi$} : \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t},
\coqdocvar{$\psi$} :
\coqdocvariable{u}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{v}) :=\coqdoceol
\coqdocindent{1em}
\ensuremath{\exists} \coqdocvar{$\iota$},
\coqdocvariable{$\varphi$} $\sqsubseteq$
\coqdocvariable{$\psi$}[\coqdocvariable{$\iota$}]$^\textsc{seq}$.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Well-formed rewrite sequences}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocdefinition{wf}
\coqdocvar{s} \coqdocvar{t}
(\coqdocvar{$\varphi$} : \coqdocvariable{s}
$\twoheadrightarrow_\mathcal{R}$
\coqdocvariable{t}) : \coqdockw{Prop}
:=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{$\varphi$} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Nil}
\coqdocvar{\_} \ensuremath{\Rightarrow}
\coqdocinductive{True}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Cons}
\coqdocvar{\_} \coqdocvar{\_} \coqdocvar{$\psi$} \coqdocvar{\_}
\coqdocvar{\_} \ensuremath{\Rightarrow}
\coqdocdefinition{wf}
\coqdocvariable{\coqdocvariable{$\psi$}}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocconstructor{Lim}
\coqdocvar{\_} \coqdocvar{\_} \coqdocvar{f} \coqdocvar{\_}
\coqdocvar{\_}  \ensuremath{\Rightarrow}
(\ensuremath{\forall} \coqdocvar{n},
\coqdocdefinition{wf} (\coqdocvariable{f}
\coqdocvariable{n})) \ensuremath{\land}
\ensuremath{\forall} \coqdocvar{n} \coqdocvar{m}, \coqdocvariable{n}
< \coqdocvariable{m} \ensuremath{\rightarrow} \coqdocvariable{f}
\coqdocvariable{n}
$\sqsubset$
\coqdocvariable{f} \coqdocvariable{m}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\end{coqdoccode}

}


\section{\texorpdfstring{UN$^\infty$}{UN} and weak orthogonality}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents[currentsection]

}


\frame{

  \frametitle{UN$^\infty$ and weak orthogonality}

  Orthogonality implies UN$^\infty$; what about weak orthogonality?\\[2em]

  The TRS
  \begin{align*}
    \rho_1 \, &: \, PSx \to x\\
    \rho_2 \, &: \, SPx \to x
  \end{align*}
  is weakly orthogonal and
  \begin{align*}
    \psi = P \, SS \, PPP \, SSSS \, PPPPP \, SSSSSS \ldots
  \end{align*}
  has two normal forms:
  \begin{align*}
    S^\omega \quad \twoheadleftarrow_{\rho_1} \quad \psi \quad
    \twoheadrightarrow_{\rho_2} \quad P^\omega
  \end{align*}

}


\frame{

  \frametitle{S$^\omega$, P$^\omega$ and $\psi$ in \Coq}

  We define finite repetitions by recursion

\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint}
\coqdocdefinition{Pnt} (\coqdocvar{n} :
\coqdocinductive{nat})
\coqdocvar{t} :=
\coqdockw{match} \coqdocvariable{n} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow} \coqdocvariable{t}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{n} \ensuremath{\Rightarrow}
\coqdocconstructor{P} @
(\coqdocdefinition{Pnt} \coqdocvariable{n}
\coqdocvariable{t})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}

and infinite repetitions by corecursion

\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{CoFixpoint}
\coqdocdefinition{S$^\omega$}
: \coqdocinductive{term} :=
\coqdocconstructor{S} @ \coqdocdefinition{S$^\omega$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

We would like to define $\psi$ as

\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{CoFixpoint}
\coqdocdefinition{$\psi'$} \coqdocvar{n}
: \coqdocinductive{term} :=\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{Snt} \coqdocvariable{n} (\coqdocdefinition{Pnt}
(\coqdocconstructor{S} \coqdocvariable{n}) (\coqdocdefinition{$\psi'$}
(\coqdocconstructor{S} (\coqdocconstructor{S}
\coqdocvariable{n})))).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\psi$} :=
\coqdocdefinition{$\psi'$} 0.\coqdoceol
\coqdocemptyline
\end{coqdoccode}

but this definition is not guarded.

}


\frame{

  \frametitle{$\psi$ in \Coq}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{CoFixpoint}
\coqdocdefinition{$\psi'$} \coqdocvar{n}
: \coqdocinductive{term} :=\coqdoceol
\coqdocindent{1.00em}
(\coqdocvar{cofix} \coqdocvar{P2nPt} (\coqdocvar{p} :
\coqdocinductive{nat})
:=\coqdoceol
\coqdocindent{2.00em}
\coqdockw{match} \coqdocvariable{p} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow} \coqdocconstructor{P}
@ (\coqdocvar{cofix} \coqdocvar{S2nt} (\coqdocvar{s} :
\coqdocinductive{nat})
:=\coqdoceol
\coqdocindent{7.50em}
\coqdockw{match} \coqdocvariable{s} \coqdockw{with}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow}
\coqdocdefinition{$\psi'$}
(\coqdocconstructor{S}
\coqdocvariable{n})\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{s} \ensuremath{\Rightarrow}
\coqdocconstructor{S} @
\coqdocconstructor{S} @ (\coqdocvariable{S2nt}
\coqdocvariable{s})\coqdoceol
\coqdocindent{7.50em}
\coqdockw{end})
(\coqdocconstructor{S}
\coqdocvariable{n})\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{p} \ensuremath{\Rightarrow}
\coqdocconstructor{P} @
\coqdocconstructor{P} @
(\coqdocvariable{P2nPt} \coqdocvariable{p})\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}) \coqdocvariable{n}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\psi$} :=
\coqdocdefinition{$\psi'$} 0.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{The TRS in \Coq}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\mathcal{R}$} :=
\coqdocdefinition{$\rho_1$} ::
\coqdocdefinition{$\rho_2$} ::
\coqdocconstructor{nil}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{wo$_\mathcal{R}$} :
\coqdocdefinition{weakly\_orthogonal} \coqdocdefinition{$\mathcal{R}$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Lemma} \coqdoclemma{nf$_{\text{S}^\omega}$} :
\coqdocdefinition{normal\_form}
(\coqdocvar{system} :=
\coqdocdefinition{$\mathcal{R}$}) \coqdocdefinition{S$^\omega$}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdoclemma{nf$_{\text{P}^\omega}$} :
\coqdocdefinition{normal\_form}
(\coqdocvar{system} :=
\coqdocdefinition{$\mathcal{R}$}) \coqdocdefinition{P$^\omega$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{neq$^{\text{S}^\omega}_{\text{P}^\omega}$} :
\ensuremath{\lnot}
\coqdocdefinition{S$^\omega$} $\sim$
\coqdocdefinition{P$^\omega$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

Now we construct rewrite sequences from $\psi$ to $S^\omega$ and
$P^\omega$.

}


\frame{

  \frametitle{Example rewrite sequences from $\psi$ to $\ldots$}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\phi_0$}
: \coqdocdefinition{$\psi$} $\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{$\psi$} :=
\coqdocconstructor{Nil}
\coqdocdefinition{$\psi$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\sigma_1$}
(\coqdocvar{x} : \coqdocdefinition{X}) :
\coqdocinductive{term} :=
\coqdockw{match} \coqdocvariable{x} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
1 \ensuremath{\Rightarrow}
\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 1
$\quad$ \ensuremath{|} $\quad$ \coqdocvar{\_} \ensuremath{\Rightarrow}
\coqdocconstructor{Var}
\coqdocvariable{x}
$\quad$ \coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\pi_1$}
: \coqdocdefinition{$\psi$} $\rightarrow_\mathcal{R}$
(\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 1) :=
\coqdocconstructor{Step}
\coqdocdefinition{$\rho_1$}
$\Box$
\coqdocdefinition{$\sigma_1$}
\coqdoclemma{\_}
\coqdoclemma{\_}
\coqdoclemma{\_}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\phi_1$}
: \coqdocdefinition{$\psi$} $\twoheadrightarrow_\mathcal{R}$
(\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 1) :=
\coqdocconstructor{Cons}
\coqdocdefinition{$\phi_0$}
\coqdocdefinition{$\pi_1$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\sigma_2$}
(\coqdocvar{x} : \coqdocdefinition{X}) :
\coqdocinductive{term} :=
\coqdockw{match} \coqdocvariable{x} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} 1 \ensuremath{\Rightarrow}
\coqdocconstructor{S} @
\coqdocconstructor{S} @
\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 2\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow}
\coqdocconstructor{Var}
\coqdocvariable{x}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\pi_2$}
: \coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 1) $\rightarrow_\mathcal{R}$
(\coqdocconstructor{S} @
\coqdocconstructor{P} @
\coqdocconstructor{P} @
\coqdocconstructor{S} @
\coqdocconstructor{S} @
\coqdocconstructor{S}\coqdoceol
\coqdocindent{1.00em} @
\coqdocdefinition{$\psi'$} 2) :=
\coqdocconstructor{Step}
\coqdocdefinition{$\rho_1$}
(\coqdocconstructor{S} @
\coqdocconstructor{P} @
\coqdocconstructor{P} @
$\Box$)
\coqdocdefinition{$\sigma_2$}
\coqdoclemma{\_}
\coqdoclemma{\_}
\coqdoclemma{\_}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\phi_2$}
: \coqdocdefinition{$\psi$} $\twoheadrightarrow_\mathcal{R}$
(\coqdocconstructor{S} @
\coqdocconstructor{P} @
\coqdocconstructor{P} @
\coqdocconstructor{S} @
\coqdocconstructor{S} @
\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} 2) :=\coqdoceol
\coqdocindent{1.00em}
\coqdocconstructor{Cons}
\coqdocdefinition{$\phi_1$}
\coqdocdefinition{$\pi_2$}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{Constructing $\psi \twoheadrightarrow S^n (\psi' n)$}

\begin{coqdoccode}
%\coqdocnoindent
%\coqdockw{Definition}
%\coqdocdefinition{$\sigma$}
%\coqdocvar{n} \coqdocvar{t} (\coqdocvar{x} :
%\coqdocdefinition{X}) :
%\coqdocinductive{term} :=\coqdoceol
%\coqdocindent{1.00em}
%\coqdockw{match} \coqdocvariable{x} \coqdockw{with}\coqdoceol
%\coqdocindent{1.00em}
%\ensuremath{|} 1 \ensuremath{\Rightarrow}
%\coqdocdefinition{Snt} \coqdocvariable{n}
%\coqdocvariable{t}\coqdoceol
%\coqdocindent{1.00em}
%\ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow}
%\coqdocconstructor{Var}
%\coqdocvariable{x}\coqdoceol
%\coqdocindent{1.00em}
%\coqdockw{end}.\coqdoceol
%\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\pi$}
\coqdocvar{m} \coqdocvar{n} \coqdocvar{t} :\coqdoceol
\coqdocindent{1.00em}\coqdocdefinition{Snt} \coqdocvariable{m}
(\coqdocdefinition{PnSnt}
(\coqdocconstructor{S}
\coqdocvariable{n}) \coqdocvariable{t}) $\rightarrow_\mathcal{R}$
\coqdocdefinition{Snt} \coqdocvariable{m}
(\coqdocdefinition{PnSnt}
\coqdocvariable{n} \coqdocvariable{t}) :=\coqdoceol
\coqdocindent{2.00em}
\coqdocinductive{Step}
\coqdocdefinition{$\rho_1$}
(\coqdocdefinition{Snc} \coqdocvariable{m}
(\coqdocdefinition{Pnc} \coqdocvariable{n}
$\Box$))
(\coqdocdefinition{$\sigma$}
\coqdocvariable{n} \coqdocvariable{t})
\coqdoclemma{\_}
\coqdoclemma{\_}
\coqdoclemma{\_}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint}
\coqdocdefinition{$\phi_a$}
\coqdocvar{m} \coqdocvar{n} \coqdocvar{t} :
\coqdocdefinition{Snt} \coqdocvariable{m}
(\coqdocdefinition{PnSnt}
\coqdocvariable{n} \coqdocvariable{t}) $\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{Snt} \coqdocvariable{m}
\coqdocvariable{t} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{n} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow}
\coqdocconstructor{Nil}
(\coqdocdefinition{Snt} \coqdocvariable{m}
\coqdocvariable{t})\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{n} \ensuremath{\Rightarrow}
\coqdocdefinition{snoc}
(\coqdocdefinition{$\pi$}
\coqdocvariable{m} \coqdocvariable{n} \coqdocvariable{t})
(\coqdocdefinition{$\phi_a$}
\coqdocvariable{m} \coqdocvariable{n} \coqdocvariable{t})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\phi_b$}
\coqdocvar{n} : \coqdocdefinition{Snt}
\coqdocvariable{n} (\coqdocdefinition{$\psi'$}
\coqdocvariable{n}) $\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{Snt}
(\coqdocconstructor{S}
\coqdocvariable{n})
(\coqdocdefinition{$\psi'$}
(\coqdocconstructor{S}
\coqdocvariable{n})) :=\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{$\phi_a$} \coqdocvariable{n} (\coqdocconstructor{S} (2
$\times$ \coqdocvariable{n})) (\coqdocconstructor{S} @
\coqdocdefinition{$\psi'$} (\coqdocconstructor{S}
\coqdocvariable{n})).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint}
\coqdocdefinition{$\phi_c$}
\coqdocvar{n} : \coqdocdefinition{$\psi$} $\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{Snt} \coqdocvariable{n}
(\coqdocdefinition{$\psi'$}
\coqdocvariable{n}) :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvariable{n} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{O}
\ensuremath{\Rightarrow}
\coqdocconstructor{Nil}
\coqdocdefinition{$\psi$}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|}
\coqdocconstructor{S}
\coqdocvar{n} \ensuremath{\Rightarrow}
\coqdocdefinition{append}
(\coqdocdefinition{$\phi_c$}
\coqdocvariable{n})
(\coqdocdefinition{$\phi_b$}
\coqdocvariable{n})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\end{coqdoccode}

}


\frame{

  \frametitle{$\omega$-step rewrite sequence from $\psi$ to $S^\omega$}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{conv}
: \coqdocdefinition{converges}
(\coqdockw{fun} \coqdocvar{n} \ensuremath{\Rightarrow}
\coqdocdefinition{Snt} \coqdocvariable{n}
(\coqdocdefinition{$\psi'$}
\coqdocvariable{n}))
\coqdocdefinition{S$^\omega$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition}
\coqdocdefinition{$\phi$}
: \coqdocdefinition{$\psi$} $\twoheadrightarrow_\mathcal{R}$
\coqdocdefinition{S$^\omega$} :=
\coqdocconstructor{Lim}
\coqdocdefinition{$\phi_c$}
\coqdoclemma{conv}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{wf$_\phi$}
: \coqdocdefinition{wf}
\coqdocdefinition{$\phi$}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}

We can now prove our lemma.

\begin{coqdoccode}
\coqdocemptyline
\coqdocemptyline
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma}
\coqdoclemma{no\_un$_\mathcal{R}$}
: \ensuremath{\lnot}
\coqdocdefinition{unique\_normal\_forms}
\coqdocdefinition{$\mathcal{R}$}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdoclemma{no\_un\_wo}
: \ensuremath{\lnot} \ensuremath{\forall} \coqdocvar{F} \coqdocvar{X}
\coqdocvar{$\mathcal{R}$},\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{weakly\_orthogonal}
(\coqdocvar{F} := \coqdocvariable{F}) (\coqdocvar{X} :=
\coqdocvariable{X}) \coqdocvariable{$\mathcal{R}$}
\ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
\coqdocdefinition{unique\_normal\_forms}
\coqdocvariable{$\mathcal{R}$}.\coqdoceol
\end{coqdoccode}

}


\section{Conclusion}


\frame{

  \frametitle{Infinitary rewriting in \Coq}

  \tableofcontents[currentsection]

}


\frame{

  \frametitle{Our \Coq-development}

  Joint work with Dimitri Hendriks\\[1em]

  Some 7500 physical lines of code
  \begin{itemize}
    \item 1250 for terms
    \item 900 for ordinals
    \item 1500 for rewriting
    \item 3000 for UN$^\infty$ and weak orthogonality\\[1em]
  \end{itemize}

  Acknowledgements
  \begin{itemize}
    \item J\"org Endrullis
    \item Vincent van Oostrom for ideas on embedding relation
    \item Peter Hancock for the order on ordinals
    \item Adam Chlipala for recursive vector type and more
    \item Matthieu Sozeau for help on dependent destruction tactic
  \end{itemize}

}


\frame{

  \frametitle{Conclusions}

  State of \Coq
  \begin{itemize}
    \item Formalizing takes too much time and working with it is tedious
    \item Guardedness restriction is too restrictive
    \item Writing \Coq code can be fun and frustrating\\[1em]
  \end{itemize}

  Our formalization
  \begin{itemize}
    \item Representation of rewrite sequences not close to paper
    \item Convergence notions are not translated easily
    \item Compression Lemma was too high a goal
  \end{itemize}

}


\frame{

  \frametitle{The End}

  Questions?\\[2em]

  \begin{block}{Selected references}
    \begin{itemize}
    \item Peter Hancock
    \item Terese
    \item RTA
    \end{itemize}
  \end{block}

}


\end{document}
